<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a hamstr Age-Depth Model — hamstr • hamstr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a hamstr Age-Depth Model — hamstr"><meta name="description" content="hamstr is used to fit an age-depth model to a set of
age-control points. Ages should already be on the desired scale, e.g.
calendar ages, and will not be calibrated. The function
calibrate_14C_age can be used to calibrate radiocarbon dates
prior to fitting a hamstr model."><meta property="og:description" content="hamstr is used to fit an age-depth model to a set of
age-control points. Ages should already be on the desired scale, e.g.
calendar ages, and will not be calibrated. The function
calibrate_14C_age can be used to calibrate radiocarbon dates
prior to fitting a hamstr model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hamstr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a hamstr Age-Depth Model</h1>

      <div class="d-none name"><code>hamstr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>hamstr</code> is used to fit an age-depth model to a set of
age-control points. Ages should already be on the desired scale, e.g.
calendar ages, and will not be calibrated. The function
<code><a href="calibrate_14C_age.html">calibrate_14C_age</a></code> can be used to calibrate radiocarbon dates
prior to fitting a hamstr model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hamstr</span><span class="op">(</span></span>
<span>  <span class="va">depth</span>,</span>
<span>  <span class="va">obs_age</span>,</span>
<span>  <span class="va">obs_err</span>,</span>
<span>  min_age <span class="op">=</span> <span class="fl">1950</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  K_fine <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  K_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">K</span>,</span>
<span>  top_depth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bottom_depth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  acc_mean_prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  acc_shape <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  mem_mean <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  mem_strength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  model_bioturbation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_ind <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  L_prior_mean <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  L_prior_shape <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  L_prior_sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model_displacement <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  D_prior_mean <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  D_prior_shape <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  D_prior_sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model_hiatus <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  H_top <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  H_bottom <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  H_max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_posterior <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  hamstr_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  stan_sampler_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-depth">depth<a class="anchor" aria-label="anchor" href="#arg-depth"></a></dt>
<dd><p>depths of observed ages (age control points)</p></dd>


<dt id="arg-obs-age">obs_age<a class="anchor" aria-label="anchor" href="#arg-obs-age"></a></dt>
<dd><p>observed age at each depth (age control points)</p></dd>


<dt id="arg-obs-err">obs_err<a class="anchor" aria-label="anchor" href="#arg-obs-err"></a></dt>
<dd><p>error associated with each observed age (1 standard error)</p></dd>


<dt id="arg-min-age">min_age<a class="anchor" aria-label="anchor" href="#arg-min-age"></a></dt>
<dd><p>the minimum age that the first modelled depth can be. Useful
if extrapolating above the shallowest age control point to e.g. the
surface. So set min_age to the year the core was collected. E.g. for a core
collected in 1990, with ages in years BP this would be -40 (present = 1950
by convention). The default value is the current year in calendar age BP
(e.g. -71 for 2021).</p></dd>


<dt id="arg-k-fine">K_fine<a class="anchor" aria-label="anchor" href="#arg-k-fine"></a></dt>
<dd><p>the number of sections at the highest resolution of the model.</p></dd>


<dt id="arg-k-factor">K_factor<a class="anchor" aria-label="anchor" href="#arg-k-factor"></a></dt>
<dd><p>the rate at which the thickness of the sections grows between
subsequent levels.</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>deprecated, use K_fine and K_factor instead.</p></dd>


<dt id="arg-top-depth-bottom-depth">top_depth, bottom_depth<a class="anchor" aria-label="anchor" href="#arg-top-depth-bottom-depth"></a></dt>
<dd><p>the top and bottom depths of the desired
age-depth model. Must encompass the range of the data. Defaults to the
shallowest and deepest data points.</p></dd>


<dt id="arg-acc-mean-prior">acc_mean_prior<a class="anchor" aria-label="anchor" href="#arg-acc-mean-prior"></a></dt>
<dd><p>hyperparameter for the prior on the overall mean
accumulation rate for the record. Units are obs_age / depth. E.g. if depth
is in cm and age in years then the accumulation rate is in years/cm. The
overall mean accumulation rate is given a weak half-normal prior with mean
= 0, SD = 10 * acc_mean_prior. If left blank, acc_mean_prior is set to the
mean accumulation rate estimated by fitting a robust linear model using
<a href="https://rdrr.io/pkg/MASS/man/rlm.html" class="external-link">rlm</a>.</p></dd>


<dt id="arg-acc-shape">acc_shape<a class="anchor" aria-label="anchor" href="#arg-acc-shape"></a></dt>
<dd><p>hyperparameter for the shape of the priors on accumulation
rates. Defaults to 4.</p></dd>


<dt id="arg-mem-mean">mem_mean<a class="anchor" aria-label="anchor" href="#arg-mem-mean"></a></dt>
<dd><p>hyperparameter; a parameter of the Beta prior distribution on
"memory", i.e. the autocorrelation parameter in the underlying AR1 model.
The prior on the correlation between layers is scaled according to the
thickness of the sediment sections in the highest resolution hierarchical
layer, <em>delta_c</em>, which is determined by the total length age-models and
the parameter vector <em>K</em>. mem_mean sets the mean value for <em>R</em> (defaults to
0.5), while <em>w</em> = R^(delta_c)</p></dd>


<dt id="arg-mem-strength">mem_strength<a class="anchor" aria-label="anchor" href="#arg-mem-strength"></a></dt>
<dd><p>hyperparameter: sets the strength of the memory prior,
defaults to 10 as in Bacon &gt;= 2.5.1</p></dd>


<dt id="arg-model-bioturbation">model_bioturbation<a class="anchor" aria-label="anchor" href="#arg-model-bioturbation"></a></dt>
<dd><p>defaults to FALSE. If TRUE, additional uncertainty
in the observed ages due to sediment mixing (bioturbation) is modelled via
a latent variable process. The amount of additional uncertainty is a
function of the mixing depth L, the sedimentation rate, and the number of
particles (e.g. individual foraminifera) per measured date. See description
for details.</p></dd>


<dt id="arg-n-ind">n_ind<a class="anchor" aria-label="anchor" href="#arg-n-ind"></a></dt>
<dd><p>the number of individual particles (e.g. foraminifera) in each
sample that was dated by e.g. radiocarbon dating. This can be a single
value or a vector the same length as obs_age. Only used if
model_bioturbation = TRUE.</p></dd>


<dt id="arg-l-prior-mean">L_prior_mean<a class="anchor" aria-label="anchor" href="#arg-l-prior-mean"></a></dt>
<dd><p>mean of the gamma prior on mixing depth, defaults to 7.5.</p></dd>


<dt id="arg-l-prior-shape-l-prior-sigma">L_prior_shape, L_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-l-prior-shape-l-prior-sigma"></a></dt>
<dd><p>shape and standard deviation of the gamma
prior on the mixing depth. Set only one of these, the other will be
calculated. Defaults to shape = 2.5. If either the shape or sigma parameter
is set to zero, the mixing depth is fixed at the value of L_prior_mean,
rather than being sampled.</p></dd>


<dt id="arg-model-displacement">model_displacement<a class="anchor" aria-label="anchor" href="#arg-model-displacement"></a></dt>
<dd><p>model additional error on observed ages that does
not scale with the number of individual particles in a sample, for example
due to incomplete mixing.</p></dd>


<dt id="arg-d-prior-mean">D_prior_mean<a class="anchor" aria-label="anchor" href="#arg-d-prior-mean"></a></dt>
<dd><p>mean of the gamma prior on additional error on observed
ages. Units are those of the depth variable, e.g. cm.</p></dd>


<dt id="arg-d-prior-shape-d-prior-sigma">D_prior_shape, D_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-d-prior-shape-d-prior-sigma"></a></dt>
<dd><p>shape and standard deviation of the gamma
prior on the additional error on observed ages. Set only one of these, the
other will be calculated. Defaults to shape = 1.5. If either the shape or
sigma parameter is set to zero, the additional error if fixed at the value
of D_prior_mean, rather than being sampled.</p></dd>


<dt id="arg-model-hiatus">model_hiatus<a class="anchor" aria-label="anchor" href="#arg-model-hiatus"></a></dt>
<dd><p>optionally model a hiatus.</p></dd>


<dt id="arg-h-top-h-bottom">H_top, H_bottom<a class="anchor" aria-label="anchor" href="#arg-h-top-h-bottom"></a></dt>
<dd><p>limits to the location of a hiatus. By default these
are set to the top and bottom data points but can be set by the user</p></dd>


<dt id="arg-h-max">H_max<a class="anchor" aria-label="anchor" href="#arg-h-max"></a></dt>
<dd><p>maximum length of the hiatus in age units</p></dd>


<dt id="arg-sample-posterior">sample_posterior<a class="anchor" aria-label="anchor" href="#arg-sample-posterior"></a></dt>
<dd><p>if set to FALSE, hamstr skips sampling the model and
returns only the data, model structure and prior parameters so that data
and prior distributions can be plotted and checked prior to running a
model. Defaults to TRUE</p></dd>


<dt id="arg-hamstr-control">hamstr_control<a class="anchor" aria-label="anchor" href="#arg-hamstr-control"></a></dt>
<dd><p>additional arguments to hamstr useful for debugging or
development. See <code><a href="hamstr_control.html">hamstr_control</a></code> for details.</p></dd>


<dt id="arg-stan-sampler-args">stan_sampler_args<a class="anchor" aria-label="anchor" href="#arg-stan-sampler-args"></a></dt>
<dd><p>additional arguments to <a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a>
passed as a named list. e.g. list(chains = 8, iter = 4000) to run 8 MCMC
chains of 4000 iterations instead of the default 4 chains of 2000
iterations. See <code><a href="get_stan_sampler_args.html">get_stan_sampler_args</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns an object of class "hamstr_fit", which is a list composed of
the output from the stan sampler .$fit, and the list of data passed to the
sampler, .$data</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">hamstr</span><span class="op">(</span></span></span>
<span class="r-in"><span>  depth <span class="op">=</span> <span class="va">MSB2K</span><span class="op">$</span><span class="va">depth</span>,</span></span>
<span class="r-in"><span>  obs_age <span class="op">=</span> <span class="va">MSB2K</span><span class="op">$</span><span class="va">age</span>,</span></span>
<span class="r-in"><span>  obs_err <span class="op">=</span> <span class="va">MSB2K</span><span class="op">$</span><span class="va">error</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Dolman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

